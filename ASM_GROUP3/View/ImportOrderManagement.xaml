<Window x:Class="ASM_GROUP3.View.ImportOrderManagement"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:ASM_GROUP3.ViewModel"
        Title="Quản lý nhập hàng" Height="750" Width="1100">

    <Window.DataContext>
        <vm:ImportOrderViewModel/>
    </Window.DataContext>

    <ScrollViewer>
        <StackPanel Margin="10">
            <!-- Thông tin phiếu nhập -->
            <GroupBox Header="Thông tin phiếu nhập" FontWeight="Bold">
                <StackPanel Margin="10">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="250"/>
                            <ColumnDefinition Width="20"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="250"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="30"/>
                        </Grid.RowDefinitions>

                        <TextBlock Text="Nhà cung cấp:" VerticalAlignment="Center"/>
                        <ComboBox Grid.Column="1" ItemsSource="{Binding Suppliers}" 
                                  DisplayMemberPath="SupplierName" SelectedItem="{Binding SelectedSupplier}"/>

                        <TextBlock Text="Ngày nhập:" Grid.Column="3" VerticalAlignment="Center" Margin="10,0,0,0"/>
                        <DatePicker Grid.Column="4" SelectedDate="{Binding SelectedOrder.OrderDate}"/>
                    </Grid>

                    <!-- Nút lệnh -->
                    <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                        <Button Content="Thêm phiếu" Command="{Binding AddOrderCommand}" Margin="5" Width="100"/>
                        <Button Content="Xóa phiếu" Command="{Binding DeleteOrderCommand}" Margin="5" Width="100"/>
                        <Button Content="Lưu" Command="{Binding SaveOrderCommand}" Margin="5" Width="100"/>
                        <Button Content="Xuất CSV" Command="{Binding ExportCsvCommand}" Margin="5" Width="100"/>
                    </StackPanel>
                </StackPanel>
            </GroupBox>

            <!-- Chi tiết nhập hàng -->
            <GroupBox Header="Chi tiết phiếu nhập" FontWeight="Bold" Margin="0,10,0,0">
                <StackPanel Margin="10">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="3*"/>
                            <ColumnDefinition Width="2*"/>
                            <ColumnDefinition Width="2*"/>
                            <ColumnDefinition Width="2*"/>
                            <ColumnDefinition Width="2*"/>
                        </Grid.ColumnDefinitions>

                        <ComboBox Grid.Column="0" ItemsSource="{Binding Seafoods}" 
                                  DisplayMemberPath="Name" SelectedItem="{Binding SelectedSeafood}" Margin="5"/>

                        <TextBox Grid.Column="1" Margin="5"
                                 Text="{Binding Quantity, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}"
                                 PreviewTextInput="NumberOnly" PreviewKeyDown="TextBox_PreviewKeyDown"/>

                        <TextBox Grid.Column="2" Margin="5"
                                 Text="{Binding UnitPrice, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}"
                                 PreviewTextInput="NumberOnly" PreviewKeyDown="TextBox_PreviewKeyDown"/>

                        <TextBox Grid.Column="3" Margin="5" IsReadOnly="True"
                                 Text="{Binding Subtotal, StringFormat=N2}"/>

                        <StackPanel Grid.Column="4" Orientation="Horizontal" HorizontalAlignment="Right">
                            <Button Content="Thêm dòng" Command="{Binding AddDetailCommand}" Width="80" Margin="5"/>
                            <Button Content="Xóa dòng" Command="{Binding DeleteDetailCommand}" Width="80" Margin="5"/>
                        </StackPanel>
                    </Grid>

                    <!-- Bảng chi tiết -->
                    <DataGrid ItemsSource="{Binding OrderDetails}" AutoGenerateColumns="False" Margin="0,10,0,0"
                              SelectedItem="{Binding SelectedDetail}" HeadersVisibility="Column" Height="200">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Hải sản" Binding="{Binding Seafood.Name}" Width="*"/>
                            <DataGridTextColumn Header="Số lượng (kg)" Binding="{Binding Quantity, StringFormat=N2}" Width="*"/>
                            <DataGridTextColumn Header="Đơn giá" Binding="{Binding UnitPrice, StringFormat=N0}" Width="*"/>
                            <DataGridTextColumn Header="Thành tiền" Binding="{Binding Subtotal, StringFormat=N0}" Width="*"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </StackPanel>
            </GroupBox>

            <!-- Danh sách phiếu nhập -->
            <GroupBox Header="Danh sách phiếu nhập" FontWeight="Bold" Margin="0,10,0,0">
                <DataGrid ItemsSource="{Binding ImportOrders}" SelectedItem="{Binding SelectedOrder}"
                          AutoGenerateColumns="False" Height="200">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Mã phiếu" Binding="{Binding OrderId}" Width="*"/>
                        <DataGridTextColumn Header="Ngày" Binding="{Binding OrderDate, StringFormat=dd/MM/yyyy}" Width="*"/>
                        <DataGridTextColumn Header="Nhà cung cấp" Binding="{Binding Supplier.SupplierName}" Width="*"/>
                        <DataGridTextColumn Header="Tổng tiền" Binding="{Binding TotalAmount, StringFormat=N0}" Width="*"/>
                        <DataGridTextColumn Header="Mặt hàng" Binding="{Binding ItemsSummary}" Width="*"/>
                    </DataGrid.Columns>
                </DataGrid>
            </GroupBox>
        </StackPanel>
    </ScrollViewer>
</Window>
